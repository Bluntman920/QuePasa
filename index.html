<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Que Pasa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" href="QuePasaLogo.png" type="image/png">
  <style>
    html, body {
      background: #23272a;
      color: #fff;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      width: 100vw;
      box-sizing: border-box;
    }
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      width: 100vw;
      overflow-x: hidden;
    }
    .header {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 32px 0 10px 0;
      width: 100vw;
      z-index: 1;
    }
    .logo {
      width: 94px;
      margin-right: 15px;
      vertical-align: middle;
    }
    .title {
      font-size: 2.3em;
      color: #1da365;
      font-weight: bold;
      letter-spacing: 0.05em;
      text-shadow: 0 2px 16px #0008;
    }
    .main-content {
      flex: 1 1 auto;
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      width: 100vw;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
    }
    .side-btn {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      background: #191f1c;
      border: none;
      border-radius: 50%;
      width: 64px;
      height: 64px;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 2px 12px #0006;
      transition: background 0.16s, transform 0.11s;
      z-index: 10;
      margin-left: 16px;
    }
    .side-btn.info-btn {
      left: 80px;
      background: #23272a;
    }
    .side-btn:hover, .side-btn.info-btn:hover {
      background: #1da365;
      transform: translateY(-50%) scale(1.05);
    }
    .side-btn img, .side-btn svg {
      width: 38px;
      height: 38px;
    }
    .leave-btn {
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 64px;
      height: 64px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5em;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 12px #0006;
      transition: background 0.16s, transform 0.11s;
      z-index: 10;
      margin-right: 16px;
    }
    .leave-btn:hover {
      background: #c0392b;
      transform: translateY(-50%) scale(1.05);
    }
    .chat-area-wrap {
      margin: 0 auto;
      flex: 1 0 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      width: 100%;
      min-width: 290px;
      max-width: 440px;
    }
    .chat-box {
      background: #252a2e;
      border-radius: 18px 18px 0 0;
      box-shadow: 0 1px 8px #0003;
      padding: 10px 0 0 0;
      margin-bottom: 0;
      display: flex;
      flex-direction: column;
      height: 340px;
      min-height: 130px;
      max-height: 420px;
      overflow: hidden;
      width: 100%;
    }
    .chat-history {
      flex: 1;
      overflow-y: auto;
      padding: 0 19px 0 19px;
      display: flex;
      flex-direction: column;
      min-height: 120px;
      max-height: 290px;
    }
    .chat-message {
      margin: 6px 0;
      padding: 9px 15px;
      max-width: 81%;
      border-radius: 10px;
      background: #1da36522;
      color: #fff;
      font-size: 1.13em;
      font-weight: 500;
      word-break: break-word;
      box-shadow: 0 1px 2px #0001;
      transition: background 0.18s;
    }
    .chat-message.me {
      align-self: flex-end;
      background: #1da365;
      color: #fff;
      font-weight: bold;
      box-shadow: 0 2px 10px #1da36522;
    }
    .chat-input-row {
      display: flex;
      gap: 8px;
      padding: 8px 12px 14px 12px;
      align-items: center;
      background: #23272a;
      border-radius: 0 0 18px 18px;
    }
    .chat-input {
      flex: 1;
      font-size: 1.14em;
      padding: 11px 14px;
      border-radius: 8px;
      border: none;
      outline: none;
      background: #31343a;
      color: #fff;
      box-shadow: 0 1px 3px #0002;
    }
    .chat-send-btn {
      background: #1da365;
      color: #fff;
      border: none;
      border-radius: 9px;
      padding: 10px 21px;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.17s;
      box-shadow: 0 1px 4px #0002;
    }
    .chat-send-btn:hover {
      background: #149150;
    }
    .modal-bg, .info-modal-bg {
      position: fixed;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: #23272aa0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    .modal, .info-modal {
      background: #252a2e;
      border-radius: 18px;
      box-shadow: 0 2px 24px #0009;
      padding: 34px 38px 24px 38px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 280px;
      max-width: 90vw;
    }
    .room-qr {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 12px #0006;
      width: 220px;
      height: 220px;
      margin-bottom: 16px;
      margin-top: 4px;
    }
    .room-code {
      font-size: 1.5em;
      color: #1da365;
      background: #23272a;
      padding: 9px 22px;
      border-radius: 12px;
      letter-spacing: 0.15em;
      font-family: 'Courier New', monospace;
      user-select: all;
      box-shadow: 0 1px 8px #0002;
      margin-bottom: 6px;
    }
    .modal-close {
      margin-top: 18px;
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 9px;
      padding: 10px 30px;
      font-size: 1.1em;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.16s;
    }
    .modal-close:hover { background: #c0392b; }
    .info-modal-content {
      max-width: 410px;
      font-size: 1.26em;
      text-align: center;
      color: #fff;
      line-height: 1.6em;
      margin-bottom: 10px;
    }
    .cashapp-support {
      margin: 45px auto 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 13px;
      background: #151a1d;
      border-radius: 18px;
      padding: 35px 18px 22px 18px;
      box-shadow: 0 2px 24px #00d64b33;
      max-width: 550px;
      width: 100vw;
    }
    .cashapp-btn {
      display: flex;
      align-items: center;
      gap: 30px;
      background: #00d64b;
      color: #fff;
      font-size: 1.5em;
      font-weight: bold;
      border: none;
      border-radius: 15px;
      padding: 18px 60px;
      cursor: pointer;
      box-shadow: 0 2px 8px #0003;
      text-decoration: none;
      transition: background 0.18s, transform 0.15s;
    }
    .cashapp-btn:hover {
      background: #009c34;
      transform: scale(1.03);
      text-decoration: none;
      color: #fff;
    }
    .cashapp-logo {
      width: 130px;
      height: 130px;
      border-radius: 16px;
      background: #fff;
      box-shadow: 0 1px 8px #0002;
      object-fit: cover;
      border: 2px solid #fff;
    }
    .cashapp-user {
      font-size: 1.25em;
      color: #00d64b;
      font-weight: bold;
      letter-spacing: 0.04em;
      background: #23272a;
      padding: 13px 42px;
      border-radius: 12px;
      display: inline-block;
      box-shadow: 0 1px 8px #00d64b11;
    }
    .cashapp-desc {
      font-size: 1.26em;
      color: #fff8;
      margin-top: 2px;
      margin-bottom: 0;
      line-height: 1.4em;
      text-align: center;
    }
    @media (max-width: 900px) {
      .main-content { flex-direction: column; align-items: center; gap: 7px; }
      .side-btn, .leave-btn { position: static; margin: 0 0 18px 0; transform: none; }
      .header { flex-direction: column; padding: 18px 0 8px 0; }
      .main-content { margin: 0; }
      .chat-area-wrap { width: 98vw !important; }
    }
    @media (max-width: 600px) {
      .logo { width: 54px; }
      .title { font-size: 1.13em; }
      .chat-box { max-width: 99vw; }
      .cashapp-logo { width: 80vw; height: 80vw; max-width: 120px; max-height: 120px;}
      .cashapp-btn { font-size: 1.08em; padding: 8px 7vw;}
      .cashapp-support { padding: 16px 4vw 9px 4vw;}
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
</head>
<body>
  <div class="header">
    <img class="logo" src="QuePasaLogo.png" alt="Que Pasa logo"/>
    <span class="title">Que Pasa</span>
  </div>
  <div class="main-content">
    <button class="side-btn info-btn" id="infoBtn" title="About this App">
      <svg viewBox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="22" fill="#191f1c" stroke="#1da365" stroke-width="4"/><text x="50%" y="62%" text-anchor="middle" fill="#1da365" font-size="32" font-family="Arial" dy=".3em">?</text></svg>
    </button>
    <button class="side-btn" id="showQrBtn" title="Show Room QR Code">
      <img src="camera.svg" alt="Show QR">
    </button>
    <div class="chat-area-wrap">
      <div class="chat-box">
        <div class="chat-history" id="chatHistory"></div>
        <form class="chat-input-row" id="chatForm" autocomplete="off">
          <input class="chat-input" id="chatInput" placeholder="Type a message..." autocomplete="off" />
          <button type="submit" class="chat-send-btn">Send</button>
        </form>
      </div>
    </div>
    <button class="leave-btn" id="leaveBtn" title="Leave Room">&#x2715;</button>
  </div>
  <div id="qrModal" style="display:none;">
    <div class="modal-bg" id="modalBg">
      <div class="modal">
        <canvas id="qrCanvas" class="room-qr" width="220" height="220"></canvas>
        <div class="room-code" id="roomCodeDisplay"></div>
        <button class="modal-close" id="closeQrBtn">Close</button>
      </div>
    </div>
  </div>
  <div id="infoModal" style="display:none;">
    <div class="info-modal-bg" id="infoModalBg">
      <div class="info-modal">
        <div class="info-modal-content">
          <b>What is Que Pasa?</b><br><br>
          This is a super simple, private group chat—just for you and your friends.<br>
          When you open the app, you get a unique room. Share the room QR code, and others can join instantly.<br><br>
          <b>What’s the catch?</b><br>
          None. No signups, no history, no tracking.<br>
          When you leave, the party’s over and the room is gone.<br><br>
          <b>Why?</b><br>
          Because sometimes you just want to have a good time, talk with your people, and maybe support the next round of snacks. 🍕🍻<br>
        </div>
        <button class="modal-close" id="closeInfoBtn">Close</button>
      </div>
    </div>
  </div>
  <div class="cashapp-support">
    <a class="cashapp-btn" href="https://cash.app/$QuePasaAPP" target="_blank" rel="noopener">
      <img class="cashapp-logo" src="CashappQR.png" alt="Cash App Logo"/>
      Support Que Pasa on Cash App
    </a>
    <span class="cashapp-user">$QuePasaAPP</span>
    <div class="cashapp-desc">
      Yo, honestly I just want to kick it with friends and have a good time.<br>
      If you want to support the party, you’re a legend—thanks bro!
    </div>
  </div>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDNz_qKPg7LfhVcXtKKTcTU-ynfBLkOSC4",
      authDomain: "quepasaapp-2e0f7.firebaseapp.com",
      databaseURL: "https://quepasaapp-2e0f7-default-rtdb.firebaseio.com",
      projectId: "quepasaapp-2e0f7",
      storageBucket: "quepasaapp-2e0f7.firebasestorage.app",
      messagingSenderId: "500826556029",
      appId: "1:500826556029:web:707b10faf864433d71d314",
      measurementId: "G-ZL2TN8H31C"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function makeRoomCode() {
      const chars = "ABCDEFGHJKMNPQRSTUVWXYZ23456789";
      let code = "";
      for (let i = 0; i < 6; ++i) code += chars[Math.floor(Math.random() * chars.length)];
      return code;
    }
    function drawQR(code) {
      if (!code) return;
      setTimeout(() => {
        new QRious({
          element: document.getElementById('qrCanvas'),
          value: `${location.origin}${location.pathname}?room=${encodeURIComponent(code)}`,
          size: 220,
          background: '#fff',
          foreground: '#23272a'
        });
      }, 0);
    }

    // State
    let myId = Math.random().toString(36).slice(2,9);
    let myRoomCode = null;
    let isHost = false;
    let chatRef = null;

    // QR Modal logic
    function openQrModal() {
      document.getElementById('qrModal').style.display = 'block';
      drawQR(myRoomCode);
      document.getElementById('roomCodeDisplay').textContent = myRoomCode.split('').join(' ');
    }
    function closeQrModal() {
      document.getElementById('qrModal').style.display = 'none';
    }
    document.getElementById('showQrBtn').onclick = openQrModal;
    document.getElementById('closeQrBtn').onclick = closeQrModal;
    document.getElementById('modalBg').onclick = function(e) {
      if (e.target === this) closeQrModal();
    };

    // Info Modal logic
    function openInfoModal() {
      document.getElementById('infoModal').style.display = 'block';
    }
    function closeInfoModal() {
      document.getElementById('infoModal').style.display = 'none';
    }
    document.getElementById('infoBtn').onclick = function() {
      if(document.getElementById('infoModal').style.display === 'block') {
        closeInfoModal();
      } else {
        openInfoModal();
      }
    };
    document.getElementById('closeInfoBtn').onclick = closeInfoModal;
    document.getElementById('infoModalBg').onclick = function(e) {
      if (e.target === this) closeInfoModal();
    };

    function joinRoomAndShow(code, setHost) {
      myRoomCode = code;
      isHost = !!setHost;
      setupChatFirebase(code);
      if (window.html5QrCodeObj) window.html5QrCodeObj.stop();
    }
    function setupChatFirebase(room) {
      if (chatRef) chatRef.off();
      chatRef = db.ref('rooms/' + room + '/chat');
      chatRef.on('value', snap => {
        const chat = snap.val() || [];
        updateChatHistory(chat);
      });
    }
    function updateChatHistory(chat) {
      const chatDiv = document.getElementById('chatHistory');
      chatDiv.innerHTML = "";
      chat.forEach(msg => {
        let div = document.createElement('div');
        div.className = "chat-message" + (msg.who === myId ? " me" : "");
        div.textContent = msg.text;
        chatDiv.appendChild(div);
      });
      chatDiv.scrollTop = chatDiv.scrollHeight;
    }
    document.getElementById('chatForm').onsubmit = function(e) {
      e.preventDefault();
      const input = document.getElementById('chatInput');
      const text = input.value.trim();
      if (!text || !myRoomCode) return;
      chatRef.once('value').then(snap => {
        const chat = snap.val() || [];
        chat.push({ who: myId, text });
        chatRef.set(chat);
        input.value = "";
        setTimeout(() => {
          document.getElementById('chatInput').focus();
        }, 10);
      });
    };
    document.getElementById('leaveBtn').onclick = () => {
      if (isHost && myRoomCode) db.ref('rooms/' + myRoomCode).remove();
      myRoomCode = null; isHost = false;
      location.reload();
    };

    // On load: If ?room=CODE join, else create new
    function startRoom() {
      const urlParams = new URLSearchParams(window.location.search);
      let code = urlParams.get('room');
      if (code && /^[A-Z2-9]{6}$/i.test(code)) {
        code = code.toUpperCase();
        db.ref('rooms/' + code + '/meta').once('value').then(snap => {
          if (!snap.exists()) {
            createAndJoinNewRoom();
          } else {
            joinRoomAndShow(code, false);
          }
        });
      } else {
        createAndJoinNewRoom();
      }
    }
    function createAndJoinNewRoom() {
      let code = makeRoomCode();
      myRoomCode = code;
      isHost = true;
      db.ref('rooms/' + code + '/meta').set({
        created: Date.now(),
        hostId: myId
      }).then(() => {
        joinRoomAndShow(code, true);
      });
    }

    // When anyone leaves, destroy the room
    window.onbeforeunload = () => {
      if (isHost && myRoomCode) db.ref('rooms/' + myRoomCode).remove();
    };
    window.addEventListener('DOMContentLoaded', startRoom);
  </script>
</body>
</html>
